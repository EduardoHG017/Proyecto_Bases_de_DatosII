# ===================================================================
# CONFIGURACIÓN POSTGRESQL.CONF - NODO READONLY
# ===================================================================
# Configuración para el servidor PostgreSQL de solo lectura
# Optimizado para consultas y reportes

# CONFIGURACIÓN DE CONEXIONES
listen_addresses = '*'                  # Escuchar en todas las interfaces
port = 5432                            # Puerto por defecto
max_connections = 150                  # Más conexiones para consultas

# CONFIGURACIÓN DE MEMORIA (optimizada para lectura)
shared_buffers = 256MB                 # Más memoria para buffers de lectura
effective_cache_size = 1GB             # Mayor cache para consultas
work_mem = 8MB                        # Más memoria para operaciones de ordenamiento
maintenance_work_mem = 128MB          # Memoria para mantenimiento

# CONFIGURACIÓN DE WAL (Write-Ahead Logging)
wal_level = replica                    # Nivel de WAL para replicación
max_wal_size = 1GB                    # Tamaño máximo de WAL
min_wal_size = 80MB                   # Tamaño mínimo de WAL

# CONFIGURACIÓN DE REPLICACIÓN
max_wal_senders = 0                   # No envía WAL (solo recibe)
wal_keep_size = 256MB                 # Menos WAL necesario
hot_standby = on                      # Permitir consultas en modo standby
hot_standby_feedback = on             # Enviar feedback al primario

# CONFIGURACIÓN ESPECÍFICA PARA READONLY
archive_mode = off                    # No archivar (solo lectura)

# CONFIGURACIÓN DE RECOVERY
recovery_target_timeline = 'latest'   # Seguir la línea de tiempo más reciente

# CONFIGURACIÓN DE LOGGING
logging_collector = on                # Habilitar colector de logs
log_directory = 'log'                # Directorio de logs
log_filename = 'postgresql-readonly-%Y-%m-%d_%H%M%S.log'
log_statement = 'all'                # Registrar todas las sentencias SQL
log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h READONLY '

# CONFIGURACIÓN DE RENDIMIENTO (optimizada para lectura)
checkpoint_timeout = 10min           # Checkpoints menos frecuentes
random_page_cost = 1.0               # Acceso más eficiente a páginas
effective_io_concurrency = 4         # Mayor concurrencia de E/S para lecturas
seq_page_cost = 1.0                  # Costo de acceso secuencial

# CONFIGURACIÓN DE CONSULTAS
default_statistics_target = 200      # Mejores estadísticas para el planificador
from_collapse_limit = 12             # Límite para colapsar subconsultas
join_collapse_limit = 12             # Límite para colapsar joins

# CONFIGURACIÓN DE AUTOVACUUM (reducida para readonly)
autovacuum = on                      # Habilitar autovacuum básico
autovacuum_max_workers = 1           # Mínimos workers de autovacuum
autovacuum_vacuum_threshold = 100    # Umbral más alto para vacuum

# ZONA HORARIA
timezone = 'America/Mexico_City'      # Zona horaria del proyecto

# CONFIGURACIONES ADICIONALES PARA READONLY
wal_receiver_timeout = 60s           # Timeout para recepción de WAL
wal_retrieve_retry_interval = 5s     # Intervalo de reintento para WAL
max_standby_streaming_delay = 30s    # Delay máximo para streaming
max_standby_archive_delay = 30s      # Delay máximo para archivos