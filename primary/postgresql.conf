# ===================================================================
# CONFIGURACIÓN POSTGRESQL.CONF - NODO PRIMARIO
# ===================================================================
# Configuración para el servidor PostgreSQL primario que acepta
# lecturas y escrituras, y actúa como fuente de replicación

# CONFIGURACIÓN DE CONEXIONES
listen_addresses = '*'                  # Escuchar en todas las interfaces
port = 5432                            # Puerto por defecto
max_connections = 100                  # Máximo número de conexiones

# CONFIGURACIÓN DE MEMORIA
shared_buffers = 128MB                 # Memoria compartida para buffers
effective_cache_size = 512MB           # Estimación de cache del SO
work_mem = 4MB                        # Memoria para operaciones de ordenamiento

# CONFIGURACIÓN DE WAL (Write-Ahead Logging)
wal_level = replica                    # Nivel de WAL para replicación
max_wal_size = 1GB                    # Tamaño máximo de WAL
min_wal_size = 80MB                   # Tamaño mínimo de WAL
checkpoint_completion_target = 0.9     # Objetivo de completación de checkpoint

# CONFIGURACIÓN DE REPLICACIÓN
max_wal_senders = 10                  # Máximo número de procesos WAL sender
wal_keep_size = 512MB                 # Cantidad de WAL a mantener
hot_standby = on                      # Permitir consultas en modo standby

# CONFIGURACIÓN DE ARCHIVADO (para respaldos)
archive_mode = on                     # Habilitar archivado de WAL
archive_command = 'cp %p /backups/wal_archive/%f'  # Comando de archivado

# CONFIGURACIÓN DE LOGGING
logging_collector = on                # Habilitar colector de logs
log_directory = 'log'                # Directorio de logs
log_filename = 'postgresql-%Y-%m-%d_%H%M%S.log'  # Formato de nombre de archivo
log_statement = 'all'                # Registrar todas las sentencias SQL
log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h '

# CONFIGURACIÓN DE RENDIMIENTO
checkpoint_timeout = 5min            # Tiempo entre checkpoints
random_page_cost = 1.1               # Costo de acceso aleatorio a páginas
effective_io_concurrency = 2         # Concurrencia de E/S

# CONFIGURACIÓN DE AUTOVACUUM
autovacuum = on                      # Habilitar autovacuum
autovacuum_max_workers = 3           # Trabajadores máximos de autovacuum

# ZONA HORARIA
timezone = 'America/Mexico_City'      # Zona horaria del proyecto