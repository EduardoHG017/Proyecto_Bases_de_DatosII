# ===================================================================
# CONFIGURACIÓN POSTGRESQL.CONF - NODO STANDBY
# ===================================================================
# Configuración para el servidor PostgreSQL standby que actúa como
# replica del primario y está listo para failover manual

# CONFIGURACIÓN DE CONEXIONES
listen_addresses = '*'                  # Escuchar en todas las interfaces
port = 5432                            # Puerto por defecto
max_connections = 100                  # Máximo número de conexiones

# CONFIGURACIÓN DE MEMORIA
shared_buffers = 128MB                 # Memoria compartida para buffers
effective_cache_size = 512MB           # Estimación de cache del SO
work_mem = 4MB                        # Memoria para operaciones de ordenamiento

# CONFIGURACIÓN DE WAL (Write-Ahead Logging)
wal_level = replica                    # Nivel de WAL para replicación
max_wal_size = 1GB                    # Tamaño máximo de WAL
min_wal_size = 80MB                   # Tamaño mínimo de WAL
checkpoint_completion_target = 0.9     # Objetivo de completación de checkpoint

# CONFIGURACIÓN DE REPLICACIÓN
max_wal_senders = 5                   # Preparado para ser promovido a primario
wal_keep_size = 512MB                 # Cantidad de WAL a mantener
hot_standby = on                      # Permitir consultas en modo standby
hot_standby_feedback = on             # Enviar feedback al primario

# CONFIGURACIÓN ESPECÍFICA PARA STANDBY
# Estas configuraciones permiten que el nodo sea promovido a primario
archive_mode = on                     # Listo para archivar cuando sea primario
archive_command = 'cp %p /backups/wal_archive/%f'  # Comando de archivado

# CONFIGURACIÓN DE RECOVERY
recovery_target_timeline = 'latest'   # Seguir la línea de tiempo más reciente
restore_command = 'cp /backups/wal_archive/%f %p'  # Comando para restaurar WAL

# CONFIGURACIÓN DE LOGGING
logging_collector = on                # Habilitar colector de logs
log_directory = 'log'                # Directorio de logs
log_filename = 'postgresql-standby-%Y-%m-%d_%H%M%S.log'
log_statement = 'all'                # Registrar todas las sentencias SQL
log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h STANDBY '

# CONFIGURACIÓN DE RENDIMIENTO
checkpoint_timeout = 5min            # Tiempo entre checkpoints
random_page_cost = 1.1               # Costo de acceso aleatorio a páginas
effective_io_concurrency = 2         # Concurrencia de E/S

# CONFIGURACIÓN DE AUTOVACUUM
autovacuum = on                      # Habilitar autovacuum
autovacuum_max_workers = 2           # Menos workers en standby

# ZONA HORARIA
timezone = 'America/Mexico_City'      # Zona horaria del proyecto

# CONFIGURACIONES ADICIONALES PARA STANDBY
wal_receiver_timeout = 60s           # Timeout para recepción de WAL
wal_retrieve_retry_interval = 5s     # Intervalo de reintento para WAL